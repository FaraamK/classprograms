CREATE TABLE EMP
(EMPNO VARCHAR2(5) PRIMARY KEY,
EMPNAME VARCHAR2(10) NOT NULL,
EMPSAL NUMBER,
EMPSUPV VARCHAR2(5) REFERENCES EMP(EMPNO));
/*creates emp table for trigger*/

CREATE OR REPLACE TRIGGER  SALARY_TRIGGER
FOR INSERT OR UPDATE ON EMP
COMPOUND TRIGGER
SALARY NUMBER;
SUPERVISOR VARCHAR2(5);
SUPERVISOR_SALARY NUMBER;
BEFORE EACH ROW IS
BEGIN
SALARY := :NEW.EMPSAL;
SUPERVISOR := :NEW.EMPSUPV;
END BEFORE EACH ROW;
AFTER STATEMENT IS
BEGIN
IF SUPERVISOR IS NOT NULL THEN 
SELECT EMPSAL
INTO SUPERVISOR_SALARY
FROM EMP
WHERE EMPNO = SUPERVISOR;
END IF;
IF(SUPERVISOR_SALARY < SALARY) THEN 
RAISE_APPLICATION_ERROR(-20099, 'ERROR! SALARY CANNOT BE HIGHER THEN SUPERVISORS SALARY!');
END IF;
END AFTER STATEMENT;
END;

INSERT INTO EMP
VALUES ('A0001', 'MOE', 1000, NULL);
INSERT INTO EMP
VALUES ('A0002', 'LARRY', 900, 'A0001');
INSERT INTO EMP
VALUES ('A0003', 'CURLY', 750, 'A0002');
INSERT INTO EMP
VALUES ('A0004', 'SHEMP', 1250, 'A0001');

UPDATE EMP SET EMPSAL = 1000 WHERE EMPNO = 'A0003';
